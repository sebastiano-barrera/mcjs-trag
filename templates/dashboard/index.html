<!doctype html>

<html>
  <head>
    <title>mcjs - Are we ECMAScript yet?</title>
    <style>
      html, body {
        background: #333;
        margin: 0;
        padding: 0;
        color: #eee;
        width: 100%;
        height: 100%;
        font-family: sans-serif;
        font-size: 8pt;
      }

      #top-ctr {
        display: grid;
        grid-template-rows: 8mm minmax(0, 1fr);
        grid-template-columns: 60mm minmax(0, 1fr);
      }

      #top-ctr .panel {
        border-right: 1px solid #ccc;
      }
      #top-ctr .panel:last-child {
        border-right: none;
      }

      td, th {
        padding: 0;
        margin: 0;
      }
      th {
        text-transform: uppercase;
      }
      .version {
        font-family: 'Iosevka', monospace;
      }
      .panel {
        overflow: scroll;
      }
      .panel table {
        width: 100%;
        border-spacing: 0;
      }
      .panel thead {
        position: sticky;
        top: 0;
        background: #333;
        text-align: left;
      }

      table tbody tr:nth-child(even) {
        background: #444;
      }
      table tbody tr:hover {
        background: #555;
      }
      td, th {
        padding: 0 2mm;
      }
      td.number {
        font-family: monospace;
        text-align: right;
      }
      
      .bar {
        background: #a4423e;
        height: 1px;
        width: 3cm;
      }
      .bar-fill {
        background: #0dcc72;
        height: 1px;
      }

      .cursor-pointer {
        cursor: pointer;
      }
    </style>

    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.js"></script>
    <script>
      async function reloadCommits() {
        const res = await fetch('/commits.json');
        const data = await res.json();
        for (const commit of data.commits) {
          commit.commit_id_short = commit.commit_id.slice(0, 8);
        }
        return data.commits;
      }

      async function fetchCommitDetails(commitID) {
        const res = await fetch(`/${commitID}.json`);
        return await res.json();
      }
    </script>
  </head>

  <body
    id="top-ctr" 
    x-data="{ focusCommit: null }"
    @commitSelected="focusCommit = await fetchCommitDetails($event.detail)"
  >
    <div style="grid-column: 1 / -1">
      Are we ECMAScript yet?
    </div>
    <div
      x-data="{ commits: [] }"
      x-init="commits = reloadCommits()"
      class="panel"
    >
      <table>
        <thead>
          <tr>
            <th>Version</th>
            <th></th>
          </tr>
        </thead>

        <tbody>
          <template x-for="commit in commits">
            <tr class="cursor-pointer" @click="$dispatch('commitselected', commit.commit_id)">
              <td><span class="version" x-text="commit.commit_id_short"></span></td>
              <td class="number">
                <span x-text="commit.n_success"></span>
                / <span x-text="commit.n_total"></span>
              </td>
            </tr>
          </template>
        </tbody>
      </table>
    </div>
    <div class="panel">
      <template x-if="focusCommit === null">
        <div>
          (Select a commit)
        </div>
      </template>

      <template x-if="focusCommit !== null">
        <table>
          <thead>
            <tr>
              <th>group</th>
              <th>OK</th>
              <th>fail</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <template x-for="group in focusCommit.groups">
              <tr>
                <td x-text="group.path"></td>
                <td class="number" x-text="group.n_ok"></td>
                <td class="number" x-text="group.n_fail"></td>
                <td>
                  <div class="bar">
                    <div class="bar-fill" x-bind:style="{ width: (100 * group.n_ok / (group.n_ok + group.n_fail)) + '%' }"></div>
                  </div>
                </td>
              </tr>
            </template>
          </tbody>
        </table>
      </template>
    </div>
  </body>
</html>



